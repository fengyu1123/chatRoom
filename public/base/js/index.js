!function(e){var n={};function r(t){if(n[t])return n[t].exports;var i=n[t]={exports:{},id:t,loaded:!1};return e[t].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}r.m=e,r.c=n,r.p="",r(0)}([function(t,i,c){"use strict";var u=function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,i){var e=[],n=!0,r=!1,s=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done)&&(e.push(a.value),!i||e.length!==i);n=!0);}catch(t){r=!0,s=t}finally{try{!n&&o.return&&o.return()}finally{if(r)throw s}}return e}(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")},l=c(1);Promise.all([l.import("vue"),l.import("jquery"),l.import("clipboard"),l.import("layer")]).then(function(t){var i=u(t,4),e=i[0],a=i[1],n=i[2],r=i[3],s=c(3);l.import("velocity");var o=function(t){return a.get("/webview/api/getSharedChats",t)},h={key:"activityNovel",getAll:function(){var t=localStorage.getItem(this.key);return t=t&&JSON.parse(t)||{}},setItem:function(t){var i=this.getAll();i[t]=1,localStorage.setItem(this.key,JSON.stringify(i))},getItem:function(t){return this.getAll()[t]}};new e({el:"#J_wrap",data:function(){return{novelId:SCOPE.novelId,isLimit:SCOPE.isLimit,chapterNodes:[],branch:{},nodes:[],branchOptions:[],isOptionsVisible:!1,isToastVisible:!1,isGuideVisible:!0,isReadEnd:!1}},mounted:function(){var i=this,t=this.novelId;this.isLimit&&h.getItem(t)?(this.hideGuide(),this.isToastVisible=!0):this.getData().then(function(t){i.initBranch(),i.$nextTick(function(){i.listen()})})},methods:{getData:function(){var e=this,t={novelId:this.novelId};return o(t).then(function(t){var i=t.data;e.chapterNodes=i.novel})},initBranch:function(){this.branch=s(this.chapterNodes),this.nodes=this.branch.getChapter(),this.branchOptions=this.branch.getBranchOptions()},formatContent:function(t,i){var e=t.replace(/[\r\n]/g,"<br>");return/\.(png|jpg|jpeg|gif)$/i.test(e)&&(e='<img style="max-width: 14rem" src="http://img.duihua.doufu.la/'+e+'" />'),e},choiceBranch:function(t){this.isOptionsVisible=!1;var i=t.next_chat_ids;if(i&&t.isBranchOption){this.branch.afterChoice(t);var e=this.branch.getChapter(i),n=e.length;if(n){-1===parseInt(e[n-1].next_chat_ids)&&(this.isReadEnd=!0);var r=this.nodes.length;this.nodes[r-1]=t,this.nodes=this.nodes.concat(e);var s=this.branch.getBranchOptions();1===(this.branchOptions=s).length&&this.choiceBranch(s[0])}}},reset:function(){this.nodes=this.branch.reset()},closeToast:function(){this.isToastVisible=!1},hideGuide:function(){this.isGuideVisible&&(this.isGuideVisible=!1)},scroll:function(){},listen:function(){var e=this,n=(a(".toast"),a(".invite"),a(window)),r=a("#J_wrap"),s=1;r.on("click",function(){if(e.hideGuide(),!r.hasClass("velocity-animating")&&!e.isOptionsVisible){var t=a(".list_item").eq(s);s===e.nodes.length-1&&(e.isReadEnd&&(e.isToastVisible=!0,e.isLimit&&h.setItem(e.novelId)),e.isOptionsVisible=!0),t.css({display:"flex",opacity:"0"});var i=r.outerHeight()-n.height();0<i?r.velocity("scroll",{offset:Math.ceil(i),duration:300,complete:function(){t.velocity({opacity:1},300)}}):t.velocity({opacity:1},300),s++}})}}});new n("#J_copy",{text:function(){return a("#J_inviteNum").text()}}).on("success",function(t){r.msg("复制成功")})})},function(t,i,e){"use strict";var n=e(2);function r(t){return"//imgdh.doufu.la/"+t}n.config({map:{jquery:r("jquery/jquery-3.2.1.min.js"),layer:"http://img.duihua.doufu.la/layer/layer.js",swiper:r("swiper/swiper.min.js"),lazysizes:r("lazysizes.min.js"),vue:"https://cdn.bootcss.com/vue/2.4.4/vue.js",clipboard:"http://img.duihua.doufu.la/clipboard/clipboard.min.js",velocity:"http://img.duihua.doufu.la/jquery/velocity.min.js"},depCache:{velocity:["jquery"]}}),t.exports=n},function(t,i){t.exports=SystemJS},function(t,i){"use strict";var e=function(){function n(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,i,e){return i&&n(t.prototype,i),e&&n(t,e),t}}();var n=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.chats=t;var n=[],r=[];this.chats.forEach(function(t){var i=(t.id||index)+"";n.push(i);var e=t.next_chat_ids;e&&-1!=e&&r.push(e)}),this.chatIds=n,this.headIds=r,this.nodes=[],this.branchOptions=[]}return e(i,[{key:"isHead",value:function(t){return t&&-1<this.headIds.indexOf(t.id+"")}},{key:"getChapter",value:function(t){for(var i,e,n=this.chatIds,r=this.chats,s=t?n.indexOf(t+""):0,a=s,o=r.length,h=o;a<r.length;++a){var c=r[a].next_chat_ids;if(c){if(-1===parseInt(c,10)){h=Math.min(a+1,o-1);break}if(1===(c=c.split(",")).length){for(var u=a;i=r[u],e=void 0,(e=i.next_chat_ids)&&1===e.split(",").length;){var l=r[u];if(l.isBranchOption=!0,this.branchOptions.push(l),u++,this.isHead(r[u]))break}h=u;break}}}var d=r.slice(s,h);return this.formatChapter(d)}},{key:"getBranchOptions",value:function(){return this.branchOptions}},{key:"formatChapter",value:function(t){var i=this.branchOptions,e=t.length-i.length,n=t.slice(0,e);if(i.length){var r=Object.assign({},i[0]);r.content="...",r.isLoading=!0,n.push(r)}return n}},{key:"afterChoice",value:function(t){this.branchOptions=[]}},{key:"reset",value:function(){return this.getChapter()}}]),i}();t.exports=function(t){return new n(t)}}]);